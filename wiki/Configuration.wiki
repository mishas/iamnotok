#summary How to configure the "I'm Not OK" application

= Introduction =

This page describe configuration process of a future version of the "I'm Not OK" application.

= Mandatory configuration =

These options are required to make the system operational.
 
 * Contacts - one or more contacts records, containing either a phone number for sending SMS notification, and/or an email address for sending email notification.

= Optional configuration =

These options let the user customize the application for her needs:

 * Call Phone Number - If a phone number is set, the system will make a voice call and open the speaker when entering emergency state. The default phone number is empty, skipping the voice call.

 * Account - when sending Email notification, the user name and email address are used for creating the mail subject and body. If not configured, the default user account is used. If no account is configured on the phone, a default "Unknown User" name is used.

 * Quite Mode - when enabled, pressing the on/off button 6 times within 5 seconds cause the application to start the emergency procedure, as if the "SOS" button was clicked within the application or the widget. This option is enabled by default.

 * Custom Message - message to use when sending SMS or email notifications. If not configured, the application uses a default message.

 * Notification Interval - when in emergency state, every Notification Interval seconds the system will send notifications to all contacts.

 * Cancelation Delay - after triggering an emergency, the system waits Cancelation Delay seconds before entering emergency state. If the user cancel the emergency within Cancelation Delay seconds, no notifications are sent.

= Contact Information =

For displaying configuration and sending notification, the system needs this info for each contact:

 * name - contact name for displaying in the contact list.
 * phone - optional phone number for sending SMS message
 * email - optional email address for sending email notification

There are few solutions for keeping contacts information.

== Use system contacts database ==

Keep a contact id and notifications preferences (send sms, send email), and get the information from the system contacts database when sending a notification, using the first mobile phone number and first email address.

Modifying the system contacts database may invalidate the emergency configuration. For example, if you added an email notification to one contact, and then you remove the email address, the email notification will not be sent.

Modifying the system contacts database may fix the emergency configuration. For example, if added an email notification, and the email address was wrong, and later you fixed the contact email address, the emergency notification will be fixed automatically.

If you modify the default email address or phone number, the emergency notification is modified silently.

== Copying contact info ==

Copy contact info from the system contacts database when adding a contact to the emergency contacts. When adding a contact, the user can select one of the mobile phone numbers or email addresses for sending notifications.

If the information in the contacts database was not correct when the contact was added to the emergency contacts, the emergency notifications may be incorrect. If you later fix the information in the contact database, the emergency information will stay incorrect.

If you delete a contact or contact phone or email, from the system contacts database, the emergency notification will not be effected.

When displaying the contacts configuration, we can display the values select when the contact was added, and use the information from the system database for modifying the current selection.

== Copying and validating ==

Keep the selected values when adding a contacts, and validate them with the system contacts database when using the contact information. The system will validate and update the emergency contacts database when displaying contacts information or when sending notifications.

If the selected value (e.g. phone number) does not exists in the system contacts database, replace it with the default value in the system contacts database. If no value exists in the system database, keep the current value.

In this case a wrong value in the emergency contacts database will be will be automatically replaced by correct value from the system contacts database, assuming that the system contacts database is more correct then the emergency database.

The schema for this solution:
{{{
create table contacts (
    id integer primary key autoincrement,
    contact_id text unique not null,
    name text not null,
    phone text,
    email text
);
}}}

== Selecting mobile phone number ==

When selecting mobile phone number, choose the first number using the label "mobile".

If no number is labeled "mobile", select the first number in the list. It is likely that a user added another phone with the default label (e.g. work) instead of selecting mobile.

When displaying list of phones, show the mobile numbers, then other numbers.

To make the selection more clear, include the label in the item text:
{{{
Select mobile phone number:
  ----------------------
 |  (054) 1234567  MOBILE |
 |  (052) 1237890  MOBILE |
 |  (034) 456789    HOME   |
  ----------------------
}}}

A simpler solution is to choose and show only numbers labeled "mobile". The user can fix the label in the contacts application. If not mobile number defined, display "No mobile phone number".

See also http://code.google.com/p/iamnotok/issues/detail?id=7